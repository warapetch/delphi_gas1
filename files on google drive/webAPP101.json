{"files":[{"id":"a4496408-2a08-4945-ab32-9d8b1a9cc0b8","name":"Code","type":"server_js","source":"// 16/09/2563  20.21\n//var url \u003d \"https://docs.google.com/spreadsheets/d/1FHV6Mt83kD3Bs_VViXi0T5ejZyGGD_P-bsVMiZaJFS0/edit#gid\u003d0\";\nvar url \u003d \"https://docs.google.com/spreadsheets/d/1HOT__gYdw5Bc2qRr5yrkDOJFX0gKmE5avO4nhvzrvqc/edit#gid\u003d0\";\nvar wsNameMember \u003d \u0027member\u0027;\nvar wsNameLog    \u003d \u0027log\u0027;  \n\n//------------------------------------\n// doGET \n//------------------------------------\nfunction doGet(e) {\n  \n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(wsNameMember); \n  var datas \u003d ws.getRange(2, 1, ws.getLastRow()-1, 5).getValues();\n\n  // Map Fields  CASE SENSITIVE !!!!!!\n  datas \u003d datas.map(function(vColumn){ \n    return  {\"id\":vColumn[0],\"name\":vColumn[1],\"lastname\":vColumn[2] ,\"tel\":vColumn[3] ,\"pay\":vColumn[4] \u003d\u003d\u003d \"\" ? 0 : vColumn[4] };\n  } );\n  \n  // Object To JsonObject\n  var jsonString \u003d JSON.stringify(datas, null, \u0027\u0027);\n  \n  // Result via Web-App (\u0027Content-Type \u003d \"Application/Json\"\u0027)\n  return ContentService.createTextOutput(jsonString).setMimeType(ContentService.MimeType.JSON);  \n  \n  }\n\n//------------------------------------\n// doGET \n//------------------------------------\nfunction doPost(request){\n  \n  openSheetSetFormat_(wsNameMember);\n  openSheetSetFormat_(wsNameLog);\n  \n  // Manage JSon [postData]\n  var jsonObj \u003d JSON.parse(request.postData.getDataAsString());\n  \n  // define an array of all the object keys\n  var keyDatas \u003d Object.keys(jsonObj);\n  var id \u003d \"\";\n  var dbaction \u003d \"\";\n  var contentDatas;\n  \n  // define an array of all the object values\n  var rowNEW \u003d keyDatas.map(function(row){ \n    \n        id \u003d  jsonObj[row].id ;\n        dbaction \u003d jsonObj[row].dbaction;\n    \n        // prepare data                           // ID value 00001 \u003e\u003e 1  !!!\n        contentDatas \u003d [ \"\u0027\"+id               ,   // add \u0027 prefix ID value for 00001 \u003e\u003e 00001 \n                            jsonObj[row].name ,  \n                            jsonObj[row].lastname,\n                            String(jsonObj[row].tel),\n                            jsonObj[row].pay\n                           ];\n    \n        AppendDatatoSheet_(wsNameLog,[\u0027contentDatas\u003d\u0027+contentDatas]);\n        AppendDatatoSheet_(wsNameLog,[\u0027id\u003d\u0027+id]);\n        AppendDatatoSheet_(wsNameLog,[\u0027String(id)\u003d\u0027+String(id)]);\n    \n        // Data Action\n        if(dbaction \u003d\u003d\u003d \u0027new\u0027 ){ AppendDatatoSheet_(wsNameMember,id,contentDatas);} else\n        if(dbaction \u003d\u003d\u003d \u0027edit\u0027){ UpdateDatatoSheet_(wsNameMember,id,contentDatas);} else\n        if(dbaction \u003d\u003d\u003d \u0027del\u0027 ){ DeleteDatafromSheet_(wsNameMember,id,contentDatas);}\n    \n        // keep log\n        // -----------------------------------------\n        /*contentDatas \u003d [String(id)   , \n                            jsonObj[row].name ,  \n                            jsonObj[row].lastname,\n                            jsonObj[row].tel,\n                            jsonObj[row].pay,\n                            dbaction ,\n                            new Date()\n                           ];    */\n        contentDatas \u003d contentDatas.concat(dbaction,new Date());\n       \n       \n       AppendDatatoSheet_(wsNameLog,contentDatas);\n       // -----------------------------------------\n    \n      });\n  \n}"},{"id":"b4eee3a9-afdb-4269-82c9-20da33686e9b","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Bangkok\",\n  \"dependencies\": {\n  },\n  \"webapp\": {\n    \"access\": \"ANYONE_ANONYMOUS\",\n    \"executeAs\": \"USER_DEPLOYING\"\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"f82eb29a-8ca7-4693-8e02-ff004dde0938","name":"lib_common","type":"server_js","source":"function setColumnFormat_(WorkSheet,ColumnName,ColumnFormat){\n\n  var cell \u003d WorkSheet.getRange(ColumnName);\n  cell.setNumberFormat(ColumnFormat);  \n  \n  //cell.setNumberFormat(\"@\");\n  //cell.setNumberFormat(\"d/M/yyyy\");\n  //cell.setNumberFormat(\"#,##0.00;(#,##0.00)\");\n}\n\n\nfunction setColumnFormatPlainText_(WorkSheet,ColumnName){\n\n  var cell \u003d WorkSheet.getRange(ColumnName);\n  cell.setNumberFormat(\"@\");\n}\n\n\nfunction setColumnFormatDate_(WorkSheet,ColumnName){\n\n  var cell \u003d WorkSheet.getRange(ColumnName);\n  cell.setNumberFormat(\"dd/MM/yyyy\");\n}\n\n\nfunction setColumnFormatCurrency_(WorkSheet,ColumnName){\n\n  var cell \u003d WorkSheet.getRange(ColumnName); \n  cell.setNumberFormat(\"#,##0.00;(#,##0.00)\");\n}  \n"},{"id":"f7d9ae8a-634e-4d46-8f3a-a203d7265691","name":"lib_data","type":"server_js","source":"function getNameByCode_(code) {\n  \n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(wsNameMember); \n  var data \u003d ws.getRange(1, 1, ws.getLastRow(), 4).getValues();\n  \n  var colCodeList \u003d data.map (function(col) { \n       return col[0]; }); \n  \n  var colNameList \u003d data.map(function(col) { \n       return [col[1]+\" \"+col[2]+\" \"+col[3]]; });\n  \n  \n  var position \u003d colCodeList.indexOf(code); \n  \n  if(position \u003e -1){\n     return colNameList[position]; } \n  else {\n       return \u0027ไม่พบข้อมูล\u0027;\n       }\n}\n\n\nfunction getRowNumber_(code) {\n  \n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(wsNameMember); \n  var data \u003d ws.getRange(1, 1, ws.getLastRow(), 1).getValues();\n  \n  var colCodeList \u003d data.map (function(col) { \n       return col[0]; }); \n  \n  var position \u003d colCodeList.indexOf(code); \n  \n  if(position \u003e -1){\n     return position+1;\n     }\n  else {\n       return -1;\n       }\n}\n\n\nfunction openSheetSetFormat_(SheetName){\n\n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(SheetName);\n  \n  setColumnFormatPlainText_(ws,\"A2:A\");\n  setColumnFormatCurrency_(ws,\"E2:E\");\n\n}\n\nfunction AppendDatatoSheet_(SheetName,ID,Datas){\n\n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(SheetName);\n  \n  setColumnFormatPlainText_(ws,\"A2:A\");\n  setColumnFormatCurrency_(ws,\"E2:E\");\n\n  // insert id \n  ws.appendRow(ID);\n  // update row\n  UpdateDatatoSheet_(SheetName,ID,Datas);\n}\n\n\nfunction UpdateDatatoSheet_(SheetName,ID,Data){\n\n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(SheetName);\n  \n  setColumnFormatPlainText_(ws,\"A2:A\");\n  setColumnFormatCurrency_(ws,\"E2:E\");\n  \n  var rowNumber \u003d getRowNumber_(ID);\n  if (rowNumber \u003e -1){\n    \n      var dataAction \u003d ws.getRange(rowNumber, 1 , 1 ,ws.getLastColumn());\n      dataAction.setValues([Data])\n     }\n}\n\nfunction DeleteDatafromSheet_(SheetName,ID,Datas){\n\n  var ss \u003d SpreadsheetApp.openByUrl(url); \n  var ws \u003d ss.getSheetByName(SheetName);\n  \n  \n  var rowNumber \u003d getRowNumber_(ID);\n  if (rowNumber \u003e -1){\n      ws.deleteRow(rowNumber);\n     }\n\n\n}\n\n"},{"id":"17d94c4c-f5dd-42e5-b572-6800e907a8ed","name":"บทเรียน doGet , doPost","type":"server_js","source":"function _doGet_(e) {\n/* \n  e.queryString\t      name\u003dalice\u0026n\u003d1\u0026n\u003d2\n  e.parameter\t      {\"name\": \"alice\", \"n\": \"1\"}\n  e.parameters\t      {\"name\": [\"alice\"], \"n\": [\"1\", \"2\"]}\n  e.contentLength\t   332\n  e.postData.length\t   332\n  e.postData.type\t   The MIME type of the POST body    \u003e\u003e text/csv\n  e.postData.contents  The content text of the POST body \u003e\u003e Alice,21\n*/\n  \n  \n  // https://...?url\u003d123\n  // {\"queryString\":\"url\u003d123\",\"contextPath\":\"\",\"contentLength\":-1,\"parameters\":{\"url\":[\"123\"]},\"parameter\":{\"url\":\"123\"}}  \n  \n  // Object to Json-String\n  var params \u003d JSON.stringify(e);\n  var urlfile \u003d e.parameter.url; \n  \n  // Json-String to Object\n  // JsonString \u003d \u0027{\"name\":\"John\", \"age\":31, \"city\":\"New York\"}\u0027;\n  // var JsonObj \u003d JSON.parse(JsonString);\n\n  \n  var ss \u003d SpreadsheetApp.openByUrl(urlfile);\n  var ws \u003d ss.getSheetByName(wsNameMember); \n  var data \u003d ws.getRange(2, 1, ws.getLastRow(), 4).getValues();\n  \n  // map Fields   JsonObject to String\n  var colNameList \u003d data.map(function(col) { \n       return [col[1]+\" \"+col[2]+\" \"+col[3]]; });  \n  \n  return HtmlService.createHtmlOutput(colNameList.toString());\n  \n}\n"}]}